<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>
    <%= title %> - System Logs
  </title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #f8f9fa;
    }

    .navbar {
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .card {
      box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
      border: 1px solid rgba(0, 0, 0, 0.125);
      margin-bottom: 1.5rem;
    }

    .log-entry {
      border-left: 4px solid #dee2e6;
      padding: 1rem;
      margin-bottom: 0.75rem;
      background-color: #fff;
      border-radius: 0 0.375rem 0.375rem 0;
      transition: box-shadow 0.2s;
    }

    .log-entry:hover {
      box-shadow: 0 0.25rem 0.5rem rgba(0, 0, 0, 0.1);
    }

    .log-entry.info {
      border-left-color: #0dcaf0;
    }

    .log-entry.warn {
      border-left-color: #ffc107;
      background-color: #fff9e6;
    }

    .log-entry.error {
      border-left-color: #dc3545;
      background-color: #fff5f5;
    }

    .log-entry.debug {
      border-left-color: #6c757d;
      background-color: #f8f9fa;
    }

    .log-timestamp {
      font-size: 0.85rem;
      color: #6c757d;
      font-family: monospace;
    }

    .log-message {
      margin: 0.5rem 0;
      font-weight: 500;
    }

    .log-details {
      font-size: 0.85rem;
      color: #495057;
      font-family: monospace;
      background-color: rgba(0, 0, 0, 0.05);
      padding: 0.75rem;
      border-radius: 0.25rem;
      margin-top: 0.5rem;
      white-space: pre-wrap;
      max-height: 300px;
      overflow-y: auto;
    }

    .job-link {
      text-decoration: none;
      font-family: monospace;
      font-size: 0.9rem;
    }

    .filter-bar {
      background-color: #fff;
      border: 1px solid #dee2e6;
      border-radius: 0.375rem;
      padding: 1rem;
      margin-bottom: 1.5rem;
    }

    .navbar-brand {
      font-weight: 600;
    }
  </style>
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container-fluid">
      <a class="navbar-brand" href="/">
        <i class="fas fa-video me-2"></i>
        Video Transcoding Service
      </a>
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb mb-0">
          <li class="breadcrumb-item"><a href="/" class="text-white-50">Dashboard</a></li>
          <li class="breadcrumb-item active text-white" aria-current="page">System Logs</li>
        </ol>
      </nav>
      <div class="navbar-nav ms-auto">
        <span class="navbar-text">
          <i class="fas fa-clock me-1"></i>
          <span id="current-time">
            <%= currentTime %>
          </span>
        </span>
      </div>
    </div>
  </nav>

  <div class="container-fluid py-4">
    <!-- Filter Bar -->
    <div class="filter-bar">
      <div class="row align-items-center">
        <div class="col-md-6">
          <h4 class="mb-0">
            <i class="fas fa-file-alt me-2"></i>
            System Logs
          </h4>
          <small class="text-muted">Showing <%= logs.length %> log entries</small>
        </div>
        <div class="col-md-6">
          <div class="d-flex gap-2 justify-content-md-end">
            <select class="form-select form-select-sm" onchange="filterLogs(this.value)" style="max-width: 150px;">
              <option value="all" <%=filters.level==='all' ? 'selected' : '' %>>All Levels</option>
              <option value="error" <%=filters.level==='error' ? 'selected' : '' %>>Errors Only</option>
              <option value="warn" <%=filters.level==='warn' ? 'selected' : '' %>>Warnings</option>
              <option value="info" <%=filters.level==='info' ? 'selected' : '' %>>Info</option>
              <option value="debug" <%=filters.level==='debug' ? 'selected' : '' %>>Debug</option>
            </select>
            <button class="btn btn-sm btn-primary" onclick="refreshLogs()">
              <i class="fas fa-sync-alt me-1"></i>
              Refresh
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Logs List -->
    <div class="row">
      <div class="col-12">
        <% if (logs && logs.length> 0) { %>
          <% logs.forEach(function(log) { %>
            <div class="log-entry <%= log.level %>">
              <div class="row">
                <div class="col-md-8">
                  <div class="d-flex justify-content-between align-items-start mb-2">
                    <div class="log-timestamp">
                      <%= new Date(log.created_at).toLocaleString() %>
                        <% if (log.stage) { %>
                          | <span class="badge bg-secondary badge-sm">
                            <%= log.stage %>
                          </span>
                          <% } %>
                    </div>
                    <span
                      class="badge bg-<%= log.level === 'error' ? 'danger' : log.level === 'warn' ? 'warning' : log.level === 'info' ? 'primary' : 'secondary' %>">
                      <%= log.level.toUpperCase() %>
                    </span>
                  </div>
                  <div class="log-message">
                    <%= log.message %>
                  </div>
                  <% if (log.details && typeof log.details==='object' ) { %>
                    <div class="log-details">
                      <%= JSON.stringify(log.details, null, 2) %>
                    </div>
                    <% } else if (log.details) { %>
                      <div class="log-details">
                        <%= log.details %>
                      </div>
                      <% } %>
                </div>
                <div class="col-md-4 text-md-end">
                  <% if (log.job_id) { %>
                    <div class="mb-2">
                      <a href="/job/<%= log.job_id %>" class="job-link text-primary">
                        <i class="fas fa-cog me-1"></i>
                        Job: <%= log.job_id.substring(0, 8) %>...
                      </a>
                    </div>
                    <% } %>
                      <% if (log.original_key) { %>
                        <div>
                          <small class="text-muted">
                            <i class="fas fa-file me-1"></i>
                            <%= log.original_key %>
                          </small>
                        </div>
                        <% } %>
                          <% if (log.job_status) { %>
                            <div class="mt-1">
                              <span class="badge bg-light text-dark">
                                <%= log.job_status %>
                              </span>
                            </div>
                            <% } %>
                </div>
              </div>
            </div>
            <% }); %>
              <% } else { %>
                <div class="text-center py-5">
                  <i class="fas fa-file-alt text-muted" style="font-size: 3rem;"></i>
                  <h5 class="mt-3 text-muted">No logs found</h5>
                  <p class="text-muted">No log entries match your current filter criteria.</p>
                </div>
                <% } %>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
  <script>
    function updateTime() {
      document.getElementById('current-time').textContent = new Date().toISOString();
    }

    function filterLogs(level) {
      const currentUrl = new URL(window.location.href);
      if (level === 'all') {
        currentUrl.searchParams.delete('level');
      } else {
        currentUrl.searchParams.set('level', level);
      }
      window.location.href = currentUrl.toString();
    }

    function refreshLogs() {
      window.location.reload();
    }

    // Update time every second
    setInterval(updateTime, 1000);
  </script>
</body>

</html>
